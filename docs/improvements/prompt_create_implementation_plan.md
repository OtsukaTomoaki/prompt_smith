# プロンプト作成機能 実装計画書

## 1. 実装目的

Promptsmithアプリケーションにおけるプロンプト作成機能を改善・拡張し、ユーザビリティの向上、追加機能の実装、パフォーマンスの最適化、および技術的負債の解消を行うことを目的とする。これにより、ユーザーがより効率的かつ直感的にAIプロンプトを作成・管理できるようにする。

## 2. 実装スケジュール

| フェーズ | 内容                       | 期間      | 担当               |
| :------- | :------------------------- | :-------- | :----------------- |
| 1        | 基本設計の確認と環境準備   | 1日目     | フロントエンド担当 |
| 2        | バリデーション改善         | 2-3日目   | フロントエンド担当 |
| 3        | プロンプトプレビュー実装   | 4-5日目   | フロントエンド担当 |
| 4        | ユーザーフィードバック強化 | 6-7日目   | フロントエンド担当 |
| 5        | モバイル対応強化           | 8-9日目   | フロントエンド担当 |
| 6        | テスト強化                 | 10-11日目 | テスト担当         |
| 7        | レビューと修正             | 12日目    | 全員               |
| 8        | デプロイ準備とリリース     | 13-14日目 | インフラ担当       |

## 3. 実装対象ファイル一覧

### 3.1 新規作成ファイル

```
components/
  └── PromptPreview.vue           # プロンプトプレビューコンポーネント
  └── ui/
      ├── Toast.vue               # トースト通知コンポーネント
      └── LoadingSpinner.vue      # ローディングスピナーコンポーネント

composables/
  ├── usePromptValidation.ts      # プロンプトバリデーション用Composable（既存）
  └── useToast.ts                 # トースト通知用Composable

tests/
  ├── components/
  │   ├── PromptPreview.test.js   # プロンプトプレビューのテスト
  │   └── ui/
  │       ├── Toast.test.js       # トースト通知のテスト
  │       └── LoadingSpinner.test.js # ローディングスピナーのテスト
  └── composables/
      └── useToast.test.js        # トースト通知Composableのテスト
```

### 3.2 修正対象ファイル

```
pages/
  ├── create.vue                  # プロンプト作成ページ
  └── edit/[id].vue               # プロンプト編集ページ

api/
  └── prompts.ts                  # プロンプトAPI

composables/
  └── usePromptsApi.ts            # プロンプトAPI用Composable

tests/
  └── pages/
      ├── create.test.js          # プロンプト作成ページのテスト
      └── edit/[id].test.js       # プロンプト編集ページのテスト
```

## 4. 詳細実装計画

### 4.1 プロンプトプレビュー機能の実装

#### 実装タスク

- [ ] PromptPreview.vueコンポーネントの作成

  - 工数: 1日
  - テスト: コンポーネントのレンダリングテスト、マークダウン変換テスト
  - 実装方針: マークダウンパーサーライブラリを使用し、リアルタイムでプレビュー表示
  - 完了条件: プロンプト本文がマークダウン形式で正しくプレビュー表示されること

- [ ] create.vueページへのプレビュー機能の統合

  - 工数: 0.5日
  - テスト: プレビュー表示の統合テスト、リアルタイム更新テスト
  - 実装方針: 2ペイン表示（編集/プレビュー）の実装、watchEffectによるリアルタイム更新
  - 完了条件: プロンプト入力時にリアルタイムでプレビューが更新されること

- [ ] edit/[id].vueページへのプレビュー機能の統合
  - 工数: 0.5日
  - テスト: プレビュー表示の統合テスト、既存データ表示テスト
  - 実装方針: create.vueと同様の実装、既存データの初期表示対応
  - 完了条件: 既存プロンプトの編集時にもプレビューが正しく機能すること

### 4.2 ユーザーフィードバック強化

#### 実装タスク

- [ ] Toast.vueコンポーネントの作成

  - 工数: 0.5日
  - テスト: コンポーネントのレンダリングテスト、表示/非表示テスト
  - 実装方針: success/error/warning状態に対応したデザイン、自動非表示機能
  - 完了条件: 各種状態のトーストが正しく表示され、自動的に非表示になること

- [ ] useToast.tsコンポーザブルの作成

  - 工数: 0.5日
  - テスト: 表示/非表示機能のテスト、タイマー機能のテスト
  - 実装方針: ref/computedを使用した状態管理、タイマーによる自動非表示
  - 完了条件: showToast/hideToast関数が正しく動作し、アプリ全体で再利用可能であること

- [ ] LoadingSpinner.vueコンポーネントの作成

  - 工数: 0.5日
  - テスト: コンポーネントのレンダリングテスト
  - 実装方針: TailwindCSSのアニメーション機能を使用したシンプルなスピナー
  - 完了条件: ローディング状態が視覚的に明確に表示されること

- [ ] create.vueとedit/[id].vueへのフィードバック機能の統合
  - 工数: 1日
  - テスト: 保存成功/エラー時のフィードバック表示テスト、ローディング表示テスト
  - 実装方針: 処理状態に応じたトースト表示、ボタンのローディング状態表示
  - 完了条件: 各種操作の結果が明確にユーザーにフィードバックされること

### 4.3 バリデーション改善

#### 実装タスク

- [ ] usePromptValidation.tsの機能拡張

  - 工数: 1日
  - テスト: 各バリデーションルールのユニットテスト
  - 実装方針: 既存のバリデーションロジックの拡張、エラーメッセージの改善
  - 完了条件: すべてのバリデーションルールが正しく機能し、わかりやすいエラーメッセージが表示されること

- [ ] リアルタイムバリデーション機能の実装

  - 工数: 1日
  - テスト: 入力中のバリデーションテスト、エラー表示テスト
  - 実装方針: watchEffectを使用した入力監視、即時フィードバック
  - 完了条件: ユーザーが入力中にリアルタイムでバリデーション結果が表示されること

- [ ] サーバーサイドバリデーションの強化
  - 工数: 1日
  - テスト: サーバーサイドバリデーションのユニットテスト、クライアント-サーバー連携テスト
  - 実装方針: api/prompts.tsでのバリデーション強化、エラーレスポンスの標準化
  - 完了条件: クライアント・サーバー両方で一貫したバリデーションが行われること

### 4.4 モバイル対応強化

#### 実装タスク

- [ ] レスポンシブデザインの改善

  - 工数: 1日
  - テスト: 各種画面サイズでのレイアウトテスト
  - 実装方針: TailwindCSSのブレークポイントを活用したレスポンシブデザイン
  - 完了条件: スマートフォン、タブレット、デスクトップで適切に表示されること

- [ ] タッチ操作の最適化

  - 工数: 1日
  - テスト: タッチデバイスでの操作テスト
  - 実装方針: タッチターゲットの拡大、スワイプ操作のサポート
  - 完了条件: タッチデバイスでの操作性が向上し、ストレスなく使用できること

- [ ] モバイル向けプレビュー表示の最適化
  - 工数: 0.5日
  - テスト: モバイル画面でのプレビュー表示テスト
  - 実装方針: 画面サイズに応じたプレビュー表示切替（タブ形式/トグル形式）
  - 完了条件: 小さな画面でもプレビュー機能が使いやすく表示されること

### 4.5 Supabaseへのプロンプト登録機能の改善

#### 実装タスク

- [ ] api/prompts.tsのエラーハンドリング強化

  - 工数: 1日
  - テスト: 各種エラーケースのテスト、エラーレスポンスのテスト
  - 実装方針: エラータイプの分類、詳細なエラーメッセージ、リトライロジック
  - 完了条件: ネットワークエラー、認証エラー、バリデーションエラーなどが適切に処理されること

- [ ] usePromptsApi.tsの機能拡張

  - 工数: 1日
  - テスト: API関数のユニットテスト、モック応答テスト
  - 実装方針: エラーハンドリングの改善、ローディング状態の管理
  - 完了条件: API呼び出しの状態管理が改善され、UIと連携してユーザー体験が向上すること

- [ ] 大きなプロンプトの保存時のUX改善
  - 工数: 1日
  - テスト: 大容量データ保存テスト、パフォーマンステスト
  - 実装方針: 非同期処理の最適化、プログレスインジケーターの表示
  - 完了条件: 大きなプロンプトの保存時もUIがフリーズせず、進行状況が表示されること

## 5. テスト計画

### 5.1 単体テスト

- **コンポーネントテスト**

  - PromptPreview.vueのレンダリングテスト
  - Toast.vueの表示/非表示テスト
  - LoadingSpinner.vueのレンダリングテスト

- **Composableテスト**

  - useToast.tsの機能テスト
  - usePromptValidation.tsの各バリデーションルールテスト
  - usePromptsApi.tsのAPI呼び出しテスト

- **APIテスト**
  - api/prompts.tsの各エンドポイントテスト
  - エラーハンドリングテスト

### 5.2 統合テスト

- **ページ統合テスト**

  - create.vueページの入力からAPI呼び出しまでの統合テスト
  - edit/[id].vueページの既存データ読み込みから更新までの統合テスト

- **フィードバック統合テスト**
  - 保存成功時のトースト表示テスト
  - エラー発生時のエラーメッセージ表示テスト
  - ローディング状態の表示テスト

### 5.3 E2Eテスト

以下のシナリオをVitest + Testing Libraryで実装：

1. **基本フロー**

   - プロンプト作成ページへのナビゲーション
   - プロンプト情報の入力
   - プレビューの確認
   - プロンプトの保存
   - 成功フィードバックの確認

2. **エラーケース**

   - 無効な入力時のバリデーションエラー表示
   - ネットワークエラー時の処理
   - 必須項目未入力時のエラー表示

3. **モバイル対応テスト**
   - 各種画面サイズでのレイアウト確認
   - タッチ操作の確認

## 6. デプロイ計画

### 6.1 デプロイ前チェックリスト

- [ ] すべての単体テストが成功すること
- [ ] すべての統合テストが成功すること
- [ ] E2Eテストが成功すること
- [ ] コードレビューが完了していること
- [ ] パフォーマンステストが完了していること
- [ ] アクセシビリティチェックが完了していること
- [ ] ブラウザ互換性テストが完了していること

### 6.2 デプロイ手順

1. ステージング環境へのデプロイ
2. ステージング環境での最終確認
3. 本番環境へのデプロイ
4. デプロイ後の動作確認
5. モニタリングの設定

### 6.3 ロールバック計画

1. 問題発生時の判断基準の設定
2. ロールバック手順の確認
3. 障害報告プロセスの確認

## 7. リスク管理

| リスク                   | 影響度 | 発生確率 | 対策                                           |
| :----------------------- | :----- | :------- | :--------------------------------------------- |
| バリデーション要件の変更 | 中     | 低       | 柔軟なバリデーション設計、設定ファイルでの管理 |
| モバイル対応の複雑化     | 高     | 中       | 早期からのレスポンシブデザイン考慮、段階的実装 |
| パフォーマンス問題       | 高     | 中       | 大きなプロンプト処理の最適化、非同期処理の改善 |
| Supabase APIの仕様変更   | 高     | 低       | バージョン管理、抽象化レイヤーの導入           |
| ブラウザ互換性の問題     | 中     | 中       | クロスブラウザテスト、ポリフィルの導入         |

## 8. 将来の拡張計画

### 8.1 短期的な拡張（次期リリース候補）

- **タグ機能**

  - プロンプトへのタグ付け
  - タグによる検索・フィルタリング

- **キーボードショートカット**
  - 保存、キャンセルなどの基本操作
  - 編集効率化のためのショートカット

### 8.2 中長期的な拡張

- **プロンプトテンプレート機能**

  - 定型プロンプトのテンプレート化
  - 変数サポート

- **バージョン管理機能**

  - プロンプトの変更履歴
  - 以前のバージョンへの復元

- **共有機能**
  - 特定ユーザーとのプロンプト共有
  - 公開/非公開設定

## 9. 実装時の注意点

### 9.1 セキュリティ

- ユーザー認証の確実な実装
- クロスサイトスクリプティング（XSS）対策
- RLSポリシーの適切な設定
- 入力データのサニタイズ

### 9.2 パフォーマンス

- 大きなプロンプトの処理最適化
- レンダリングパフォーマンスの考慮
- ネットワークリクエストの最適化
- キャッシュ戦略の実装

### 9.3 アクセシビリティ

- WAI-ARIAガイドラインの遵守
- キーボードナビゲーションのサポート
- スクリーンリーダー対応
- 十分なコントラスト比の確保

### 9.4 国際化

- 多言語対応の考慮
- 右から左へ（RTL）の言語サポートの検討
- 日付・時刻形式の地域化

### 9.5 保守性

- コンポーネントの適切な分割
- 再利用可能なコードの抽出
- 一貫した命名規則の適用
- 十分なコメントとドキュメント
