# 🧠 実装計画書実行ルール（Roo Code向け）

このドキュメントは、VSCode拡張「Roo Code」において、`docs/improvements/**`配下の実装計画書に基づく開発を最適化するためのルールセットです。以下の方針に従って実装計画書を効率的に実行してください。

---

## ✅ 実装計画書実行の基本原則

### 1. 計画書の構造理解

実装計画書は一般的に以下の構造を持つため、順序立てて処理する：

- **実装目的・概要**：機能の全体像と背景を把握
- **実装スケジュール**：フェーズ別の作業順序を確認
- **実装対象ファイル一覧**：新規作成・修正対象を特定
- **詳細実装計画**：具体的な実装内容とタスク
- **テスト計画**：品質保証の方針
- **デプロイ・リリース計画**：本番環境への展開手順

### 2. 段階的実装アプローチ

- 実装計画書の**フェーズ順**に従って段階的に実装する
- 各フェーズ完了後に動作確認を行う
- 依存関係を考慮し、基盤となる機能から実装する
- 複雑な機能は小さな単位に分割して実装する

### 3. 品質重視の開発

- 実装と同時にテストコードを作成する
- セキュリティとパフォーマンスの考慮事項を必ず実装に反映する
- エラーハンドリングを適切に実装する
- ユーザーフィードバック（ローディング、成功/エラー通知）を必ず含める

---

## 📋 実装計画書解析プロセス

### 1. 計画書の初期解析

実装計画書を受け取ったら、以下の順序で解析する：

1. **目的と要件の理解**
   - 何を実装するのか（機能概要）
   - なぜ実装するのか（背景・目的）
   - どのような価値を提供するのか（期待効果）

2. **技術要件の抽出**
   - 使用する技術スタック
   - 外部サービスとの連携
   - パフォーマンス要件
   - セキュリティ要件

3. **実装範囲の特定**
   - 新規作成が必要なファイル
   - 修正が必要な既存ファイル
   - 影響を受ける関連機能

### 2. 実装優先度の決定

以下の基準で実装順序を決定する：

1. **基盤レイヤー**（データベース、API、認証基盤など）
2. **ビジネスロジックレイヤー**（コアとなる処理ロジック）
3. **プレゼンテーションレイヤー**（UI/UXコンポーネント）
4. **統合・テストレイヤー**（結合テスト、E2Eテスト）
5. **最適化・改善レイヤー**（パフォーマンス改善、UX向上）

### 3. 依存関係の分析

- 各実装タスク間の依存関係を明確にする
- ブロッカーとなる可能性のあるタスクを特定する
- 並列実行可能なタスクを識別する

---

## 🛠️ 実装実行ルール

### 1. データ層の実装

**実装手順：**
- スキーマ設計の確認と実装
- マイグレーションファイルの作成
- インデックスとパフォーマンス最適化
- セキュリティポリシーの設定
- 初期データの投入（必要に応じて）

**品質チェック：**
- データ整合性の確認
- アクセス権限の検証
- パフォーマンステスト

### 2. API層の実装

**実装手順：**
- エンドポイント設計の確認
- リクエスト/レスポンス形式の定義
- 認証・認可の実装
- エラーハンドリングの実装
- レート制限やセキュリティ対策の実装

**品質チェック：**
- API仕様との整合性確認
- セキュリティテスト
- パフォーマンステスト

### 3. ビジネスロジック層の実装

**実装手順：**
- 再利用可能なロジックの抽象化
- 状態管理の実装
- 非同期処理の適切な管理
- エラーハンドリングの統一
- テスタビリティを考慮した設計

**品質チェック：**
- 単体テストの実装と実行
- ロジックの正確性確認
- エッジケースの処理確認

### 4. プレゼンテーション層の実装

**実装手順：**
- コンポーネント設計の確認
- 状態管理との連携
- ユーザーインタラクションの実装
- レスポンシブデザインの対応
- アクセシビリティの考慮

**品質チェック：**
- コンポーネントテストの実装
- ユーザビリティテスト
- クロスブラウザテスト

---

## 🧪 テスト実装ルール

### 1. テスト戦略の確立

- **単体テスト**: 個別の関数・メソッドの動作確認
- **統合テスト**: 複数のコンポーネント間の連携確認
- **E2Eテスト**: ユーザーフローの端から端までの確認

### 2. テスト実装のタイミング

- 実装と並行してテストコードを作成
- 各フェーズ完了時に該当するテストを実行
- リファクタリング時はテストを先に更新

### 3. テストカバレッジの確保

- 重要なビジネスロジックは100%カバレッジを目指す
- エラーケースや例外処理も含めてテスト
- パフォーマンステストも適切に実装

---

## 🔒 セキュリティ実装ルール

### 1. 認証・認可

- 適切な認証メカニズムの実装
- 最小権限の原則に基づく認可設計
- セッション管理の適切な実装

### 2. データ保護

- 機密データの暗号化
- 安全な通信プロトコルの使用
- データの適切なマスキング・匿名化

### 3. 入力検証とサニタイゼーション

- すべてのユーザー入力の検証
- SQLインジェクション対策
- XSS攻撃対策

---

## 📊 パフォーマンス最適化ルール

### 1. 効率的なデータ処理

- 必要最小限のデータ取得
- 適切なキャッシュ戦略の実装
- 非同期処理の最適化

### 2. フロントエンド最適化

- コンポーネントの適切な分割
- 不要な再レンダリングの防止
- リソースの遅延読み込み

### 3. 監視と測定

- パフォーマンスメトリクスの設定
- ボトルネックの特定と改善
- 継続的な最適化

---

## 🔄 実装フロー管理

### 1. 実装前チェックリスト

- [ ] 実装計画書の内容を完全に理解している
- [ ] 技術要件と制約を把握している
- [ ] 依存関係を特定している
- [ ] 既存システムとの整合性を確認している
- [ ] 実装対象のタスクを1つに絞り込んでいる（1タスク1PR原則）

### 2. 実装中チェックリスト

- [ ] 計画書の実装手順に従っている
- [ ] 適切なエラーハンドリングを実装している
- [ ] セキュリティ要件を満たしている
- [ ] テストコードを並行して作成している
- [ ] **実装計画書の該当タスクにチェックマークを付けている**
- [ ] 1つのタスクのみに集中している（スコープクリープの防止）

### 3. 実装後チェックリスト

- [ ] 機能要件を満たしている
- [ ] 非機能要件を満たしている
- [ ] テストが全て通過している
- [ ] ドキュメントが更新されている
- [ ] **実装計画書の該当タスクを完了状態にマークしている**
- [ ] PRの作成準備が完了している（1タスク1PR原則）

### 4. PR作成・管理ルール

#### 4.1 1タスク1PR原則

**基本ルール：**
- 実装計画書の各チェックリストタスク1つにつき、1つのPRを作成する
- 複数のタスクを1つのPRにまとめることは禁止
- 1つのタスクを複数のPRに分割することは、タスクが大きすぎる場合のみ許可

**PR作成基準：**
- タスクの完了条件を満たしている
- 関連するテストが全て通過している
- コードレビューが可能な適切なサイズである（一般的に500行以下）
- 独立してレビュー・マージ可能である

#### 4.2 PRタイトル・説明の規則

**PRタイトル形式：**
```
[実装計画書名] タスク名 - 簡潔な説明
```

**例：**
```
[OpenAI API設定機能] useOpenAiApi Composableの基本構造実装
[プロンプト作成機能] バリデーションロジックの分離
```

**PR説明に含める内容：**
- 実装計画書の該当セクション・タスクへの参照
- 実装内容の概要
- テスト結果
- 動作確認方法
- レビュー時の注意点

### 5. 実装計画書チェックリスト管理

#### 5.1 チェックリスト更新ルール

**実装開始時：**
- 該当タスクを「実装中」状態にマーク
- 実装開始日時を記録
- 担当者を明記

**実装完了時：**
- 該当タスクを「完了」状態にマーク
- 実装完了日時を記録
- 関連PRのリンクを追加
- 実際の工数を記録（計画との差異分析用）

#### 5.2 チェックリスト状態管理

実装計画書内のタスクは以下の状態で管理する：

```markdown
- [ ] 未着手のタスク
- [🔄] 実装中のタスク（開始日: YYYY-MM-DD, 担当: 名前）
- [✅] 完了したタスク（完了日: YYYY-MM-DD, PR: #123）
- [⚠️] ブロックされているタスク（理由: 依存関係待ち）
- [❌] 中止されたタスク（理由: 要件変更）
```

#### 5.3 進捗レポート

各フェーズ完了時に以下の情報を記録：

```markdown
## フェーズ X 完了レポート

### 完了タスク
- [✅] タスク1 (PR: #123, 工数: 実績/計画)
- [✅] タスク2 (PR: #124, 工数: 実績/計画)

### 課題・改善点
- 発見された問題点
- 次フェーズへの申し送り事項

### 学習・知見
- 得られた技術的知見
- プロセス改善提案
```

---

## 📝 計画書活用のベストプラクティス

### 1. 計画書の読み込み方

- 全体を通読してから詳細に入る
- 不明な点は実装前に明確にする
- 計画書に記載されたコード例は参考として活用

### 2. 計画書との差異管理

- 実装中に発見した問題や改善点を記録
- 計画書との差異が生じた場合は理由を明確にする
- 必要に応じて計画書の更新を提案

### 3. 進捗管理

- フェーズごとの完了条件を明確にする
- 定期的な進捗確認と調整
- ブロッカーの早期発見と対処

---

## 🚨 注意事項

### 1. 品質の確保

- 機能実装だけでなく、保守性・拡張性も考慮
- コードレビューの実施
- 継続的インテグレーションの活用

### 2. チーム連携

- 実装内容の共有と相談
- 既存コードとの整合性確保
- ドキュメントの適切な更新

### 3. リスク管理

- 技術的リスクの早期発見
- 代替案の検討と準備
- 適切なロールバック計画

---

## 📚 参考資料

- プロジェクト内の既存ルールファイル
- 技術スタックの公式ドキュメント
- セキュリティガイドライン
- パフォーマンス最適化のベストプラクティス

---

以上のルールに従ってRoo Codeで実装計画書に基づく開発を行ってください。体系的で効率的な実装により、高品質なソフトウェアを迅速に開発することができます。
